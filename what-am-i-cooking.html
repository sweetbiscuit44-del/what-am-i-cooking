<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>What Am I Cooking? ‚Äî Ingredient Builder by Biscuit 44</title>
<meta name="description" content="Add ingredients and get practical recipe suggestions, quick steps, substitutions and tips. Privacy-first, single-file, GitHub Pages ready." />
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üßë‚Äçüç≥</text></svg>">
<style>
  /* VARIABLES & RESET */
  :root{
    --bg:#fffaf6;
    --card:#ffffff;
    --muted:#6b6f76;
    --accent:#ff6b6b;
    --accent2:#ffb86b;
    --glass:rgba(0,0,0,0.04);
    --radius:12px;
    --chip-bg:#fff4f4;
    --chip-border:rgba(255,107,107,0.25);
    --success:#4ade80;
    --warning:#fbbf24;
    --error:#f87171;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background:linear-gradient(180deg,var(--bg),#fff6f0);
    color:#182026;
    padding:32px 16px;
    display:flex;
    align-items:flex-start;
    justify-content:center;
    min-height:100vh;
  }
  .app{width:100%;max-width:1080px}

  /* HEADER */
  header{display:flex;gap:16px;align-items:center;margin-bottom:24px}
  .logo{
    width:60px;height:60px;
    background:linear-gradient(135deg,var(--accent),var(--accent2));
    border-radius:14px;
    display:flex;align-items:center;justify-content:center;
    color:#fff;font-size:24px;font-weight:900;
    box-shadow:0 8px 30px rgba(255,107,107,0.18);
  }
  h1{margin:0;font-size:24px;font-weight:800}
  .sub{color:var(--muted);font-size:14px;line-height:1.4}

  /* PANEL & INPUT */
  .panel{
    background:var(--card);
    padding:20px;
    border-radius:var(--radius);
    border:1px solid var(--glass);
    box-shadow:0 4px 16px rgba(0,0,0,0.02);
  }
  .input-row{display:flex;gap:10px;margin-top:12px;align-items:flex-start}
  #ingInput{
    flex:1;
    padding:12px 14px;
    border-radius:10px;
    border:1px solid rgba(0,0,0,0.1);
    font-size:16px;
    min-height: 60px;
    resize: vertical;
    line-height: 1.5;
  }
  .btn{
    background:var(--accent);
    color:white;
    padding:12px 16px;
    border-radius:10px;
    border:none;
    cursor:pointer;
    font-weight:700;
    transition:background-color 0.2s, transform 0.1s;
  }
  .btn:hover{background-color:#e05b5b}
  .btn:active{transform:scale(0.98)}
  .btn.ghost{
    background:transparent;
    color:var(--muted);
    border:1px solid rgba(0,0,0,0.1);
  }
  .btn.ghost:hover{background-color:rgba(0,0,0,0.03)}
  .btn.success{background:var(--success);color:#111}

  /* CHIPS */
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;min-height:30px}
  .chip{
    background:var(--chip-bg);
    border:1px solid var(--chip-border);
    padding:6px 10px;
    border-radius:999px;
    display:flex;
    gap:6px;
    align-items:center;
    font-size:14px;
  }
  .chip button{
    all:unset;
    cursor:pointer;
    color:var(--accent);
    font-weight:700;
    margin-left:4px;
    line-height:1;
  }
  .chip button:hover{color:#d04a4a}

  /* GRID & RESULTS */
  .grid{display:grid;grid-template-columns:2fr 360px;gap:24px;margin-top:20px}
  .result{
    padding:18px;
    border-radius:var(--radius);
    border:1px solid rgba(0,0,0,0.06);
    background:linear-gradient(180deg,#fff,#fffefc);
  }
  .result h3{margin:0;font-size:20px}
  .score{font-weight:900;color:var(--accent);font-size:22px}
  .alt-list{margin-top:10px;display:flex;flex-direction:column;gap:8px}
  .alt{
    padding:12px;
    border-radius:8px;
    background:#fffaf6;
    border:1px solid rgba(0,0,0,0.05);
    display:flex;
    justify-content:space-between;
    align-items:center;
  }
  .alt button{padding:8px 12px; font-size:14px}
  .meta{color:var(--muted);font-size:13px;margin-top:2px}
  .side-panel{position:sticky;top:32px;display:flex;flex-direction:column;gap:16px}
  .small{font-size:13px;color:var(--muted);line-height:1.5}
  textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);min-height:84px}

  /* FEEDBACK BADGE */
  .feedback-badge {
    display: inline-block;
    margin-left: 10px;
    padding: 2px 8px;
    border-radius: 20px;
    font-weight: 700;
    font-size: 14px;
  }
  .feedback-good { background: var(--success); color: #000; }
  .feedback-bad { background: var(--error); color: white; }

  /* FOOTER */
  footer{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-top:32px;
    padding-top:16px;
    border-top:1px dashed rgba(0,0,0,0.1);
    color:var(--muted);
  }
  footer .small{font-size:12px}

  /* RESPONSIVE */
  @media (max-width:900px){
    .grid{grid-template-columns:1fr;gap:16px}
    .side-panel{position:static;margin-top:16px}
    body{padding:16px}
    header{margin-bottom:16px}
  }
</style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo">B44</div>
      <div>
        <h1>What Am I Cooking?</h1>
        <div class="sub">**Add ingredients, get real recipes** ‚Äî built by Biscuit 44. No tracking. No keys. Just dinner ‚ù§Ô∏è</div>
      </div>
    </header>

    <div class="panel">
      <label class="small">Add ingredients (press <strong>Enter</strong> or <strong>+ Add</strong>). Type multiple separated by commas, semicolons, or newlines.</label>
      <div class="input-row">
        <textarea id="ingInput" placeholder="e.g. chicken, garlic, rice, spinach&#10;OR&#10;beef; eggs; cheese" aria-label="Add ingredients"></textarea>
        <button class="btn" id="addBtn">Ôºã Add</button>
      </div>
      <div class="chips" id="chips"></div>

      <div style="display:flex;gap:12px;margin-top:20px;align-items:center">
        <button class="btn" id="guessBtn">üîç **Guess Dish**</button>
        <button class="btn ghost" id="randomBtn">Surprise me</button>
        <button class="btn ghost" id="clearBtn">Clear Pantry</button>
        <div style="margin-left:auto" class="small">Privacy: Runs entirely in your browser.</div>
      </div>
    </div>

    <div class="grid">
      <div>
        <div class="result" id="mainResult" aria-live="polite">
          <h3 id="mainTitle">Add ingredients to see suggestions</h3>
          <div id="mainMeta" class="meta">We'll analyze ingredient matches, common pairings, and cooking methods.</div>
          <div id="mainSteps" style="margin-top:10px"></div>
        </div>

        <div style="height:16px"></div>

        <div class="result">
          <strong>Other Top Ideas</strong>
          <div id="alternatives" class="alt-list"><div class="small">No suggestions yet ‚Äî add ingredients and press Guess.</div></div>
        </div>

        <div style="height:16px"></div>

        <div class="result">
          <strong>Saved Ideas</strong>
          <div id="savedList" class="alt-list"><div class="small">Save recipe suggestions for later (stored locally).</div></div>
        </div>
      </div>

      <aside class="side-panel">
        <div class="panel">
          <strong>Tips & Substitutions</strong>
          <div id="tips" class="small" style="margin-top:8px">Add ingredients to get practical swaps and quick tips.</div>
          <div style="height:12px"></div>
          <strong>Data Management</strong>
          <div class="small" style="margin-top:6px">The recipe matches against a small, curated database. It works fully offline.</div>
          <div style="height:10px"></div>
          <button class="btn" id="exportBtn">Export Ideas</button>
          <button class="btn ghost" id="importBtn">Import Ideas</button>
        </div>
<div class="panel">
  <strong>Support Biscuit 44</strong>
  <div class="small" style="margin-top:8px">
    If this saved you dinner time (or a grocery trip), please 
    <a href="https://paypal.me/sweetbiscuit44" style="color:var(--accent);text-decoration:none;font-weight:700" target="_blank">send $1</a> ‚Äî 
    your kindness keeps simple alive ‚ù§Ô∏è
  </div>
</div>

    <footer>
      <div class="small">Made with care by Biscuit 44 ‚Äî pure HTML, privacy-first.</div>
      <div class="small">Share your creation and tag: <strong>#Biscuit44Kitchen</strong></div>
    </footer>
  </div>

<script>
// ENHANCED INGREDIENT BUILDER ‚Äî offline, privacy-first
const ingInput = document.getElementById('ingInput');
const addBtn = document.getElementById('addBtn');
const clearBtn = document.getElementById('clearBtn');
const chipsEl = document.getElementById('chips');
const guessBtn = document.getElementById('guessBtn');
const randomBtn = document.getElementById('randomBtn');
const mainTitle = document.getElementById('mainTitle');
const mainMeta = document.getElementById('mainMeta');
const mainSteps = document.getElementById('mainSteps');
const alternatives = document.getElementById('alternatives');
const tips = document.getElementById('tips');
const savedList = document.getElementById('savedList');
const exportBtn = document.getElementById('exportBtn');
const importBtn = document.getElementById('importBtn');
const tipLink = document.getElementById('tipLink');

// SET YOUR KO-FI LINK HERE
tipLink.href = 'https://ko-fi.com/yourname'; 

let pantry = loadPantry();
let saved = loadSaved();

// --- STORAGE ---
function loadPantry(){ 
  try { 
    return JSON.parse(localStorage.getItem('b44.pantry.v3') || '[]'); 
  } catch(e) { 
    console.error("Pantry load error:", e); 
    return []; 
  } 
}
function savePantry(){ 
  localStorage.setItem('b44.pantry.v3', JSON.stringify(pantry)); 
}
function loadSaved(){ 
  try { 
    return JSON.parse(localStorage.getItem('b44.saved.v3') || '[]'); 
  } catch(e) { 
    console.error("Saved load error:", e); 
    return []; 
  } 
}
function saveSaved(){ 
  localStorage.setItem('b44.saved.v3', JSON.stringify(saved)); 
}

// --- INGREDIENT HANDLING (with count & multi-add) ---
function renderChips(){
  chipsEl.innerHTML = '';
  const counts = {};
  pantry.forEach(p => {
    counts[p] = (counts[p] || 0) + 1;
  });
  Object.entries(counts).forEach(([ing, count]) => {
    const c = document.createElement('div');
    c.className='chip';
    c.innerHTML = `<span>${escapeHtml(ing)}${count > 1 ? ` √ó${count}` : ''}</span><button title="Remove">√ó</button>`;
    c.querySelector('button').addEventListener('click', () => {
      // Remove one instance
      const index = pantry.indexOf(ing);
      if (index > -1) {
        pantry.splice(index, 1);
        savePantry();
        renderChips();
        renderResults();
      }
    });
    chipsEl.appendChild(c);
  });
  ingInput.focus();
}

function addFromInput(){
  const raw = ingInput.value.trim();
  if(!raw) return;
  
  // Split by comma, semicolon, or newline
  const parts = raw.split(/[,;\n]/).map(s=>s.trim()).filter(Boolean);
  
  // Process each part
  parts.forEach(part => {
    if (part) {
      // Normalize for storage but keep display case
      const normalized = normalize(part);
      pantry.push(normalized);
    }
  });
  
  savePantry();
  renderChips();
  ingInput.value='';
  if(pantry.length > 0) renderResults();
}

function normalize(s){ 
  return s.toLowerCase().replace(/[^a-z0-9\s]/g,' ').trim(); 
}

function escapeHtml(s){ 
  return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'<','>':'>','"':'&quot;',"'":'&#39;' }[c])); 
}

// --- EVENT LISTENERS ---
addBtn.addEventListener('click', addFromInput);
clearBtn.addEventListener('click', ()=>{ if(confirm('Clear all?')){ pantry=[]; savePantry(); renderChips(); clearResults(); } });

// Handle Enter key in textarea
ingInput.addEventListener('keydown', e=>{ 
  if(e.key==='Enter' && !e.shiftKey){ // Only trigger on Enter, not Shift+Enter
    e.preventDefault(); 
    addFromInput(); 
  } 
});

guessBtn.addEventListener('click', renderResults);

// --- ENHANCED RECIPE DATABASE ---
const RECIPES = [
  {id:'fried_rice', title:'Classic Fried Rice', ingredients:['rice','chicken','egg','onion','garlic','soy sauce','oil','carrot'], essentials:['rice','egg'], method:['Cook rice (day-old best). Saut√© aromatics, add protein, push aside, scramble eggs, mix with rice and soy sauce.'], minutes:30, tags:['asian','one-pan']},
  {id:'tomato_pasta', title:'Simple Tomato Pasta', ingredients:['pasta','tomato','garlic','olive oil','salt','pepper','basil'], essentials:['pasta','tomato'], method:['Boil pasta. Saut√© garlic in oil, add tomatoes, simmer 15 mins, toss with pasta.'], minutes:25, tags:['italian','quick']},
  {id:'omelette', title:'Fluffy Omelette', ingredients:['egg','butter','milk','salt','pepper','cheese'], essentials:['egg'], method:['Beat eggs with milk. Melt butter, pour eggs, cook gently, fold with fillings.'], minutes:10, tags:['breakfast','quick']},
  {id:'lentil_soup', title:'Hearty Lentil Soup', ingredients:['lentil','stock','carrot','celery','onion','garlic','tomato'], essentials:['lentil','stock'], method:['Saut√© veggies, add lentils and stock, simmer 30-40 mins.'], minutes:45, tags:['soup','veggie']},
  {id:'pancakes', title:'Classic Pancakes', ingredients:['flour','egg','milk','baking powder','sugar','butter'], essentials:['flour','egg','milk'], method:['Whisk dry + wet, cook on griddle until bubbles form, flip.'], minutes:20, tags:['breakfast','sweet']},
  {id:'grilled_cheese', title:'Gourmet Grilled Cheese', ingredients:['bread','cheese','butter'], essentials:['bread','cheese'], method:['Butter bread outsides, fill with cheese, grill until golden.'], minutes:10, tags:['snack','quick']},
  {id:'chicken_curry', title:'Simple Chicken Curry', ingredients:['chicken','onion','garlic','ginger','curry powder','stock','rice','oil'], essentials:['chicken','curry powder','rice'], method:['Saut√© aromatics, brown chicken, add curry powder + stock, simmer.'], minutes:40, tags:['dinner','indian']},
  {id:'stir_fry_veg', title:'Teriyaki Vegetable Stir-Fry', ingredients:['vegetable','garlic','soy sauce','oil','ginger','rice','teriyaki'], essentials:['vegetable','soy sauce'], method:['Prep veggies/sauce. Stir-fry garlic/ginger, add veggies, finish with sauce.'], minutes:25, tags:['veggie','asian']},
  {id:'dollar_biscuits', title:'$1 Fluffy Biscuits', ingredients:['flour','baking powder','butter','milk','salt'], essentials:['flour','baking powder','milk'], method:['Mix dry, cut in cold butter, add milk, fold gently, cut rounds, bake at 425¬∞F for 12-15 mins.'], minutes:25, tags:['baking','breakfast','biscuit44']},
];

const ING_SYNONYMS = {
  'chicken':['chicken','breast','thighs','poultry'],
  'rice':['rice','basmati','jasmine'],
  'egg':['egg','eggs'],
  'onion':['onion','shallot','red onion'],
  'garlic':['garlic','clove'],
  'tomato':['tomato','diced tomato','crushed'],
  'pasta':['pasta','spaghetti','noodles'],
  'butter':['butter','margarine'],
  'cheese':['cheese','cheddar','mozzarella'],
  'flour':['flour','all purpose'],
  'milk':['milk','dairy','almond milk'],
  'vegetable':['vegetable','veggies','carrot','spinach','bell pepper']
};

function normalizeToKey(s){
  s = normalize(s);
  for(const k in ING_SYNONYMS){ 
    if(ING_SYNONYMS[k].some(term => s.includes(term))) return k; 
  }
  return s;
}

// --- RECIPE ANALYSIS & VALIDATION ---
function analyzeBalance(recipe, pantryKeys) {
  const dry = ['flour', 'sugar', 'rice', 'pasta', 'lentil', 'baking powder', 'salt'];
  const wet = ['milk', 'egg', 'oil', 'butter', 'stock', 'soy sauce', 'tomato'];
  const leavening = ['baking powder', 'baking soda', 'yeast'];
  
  let dryCount = 0, wetCount = 0, leaveningCount = 0;
  pantryKeys.forEach(k => {
    if (dry.includes(k)) dryCount++;
    if (wet.includes(k)) wetCount++;
    if (leavening.includes(k)) leaveningCount++;
  });
  
  const issues = [];
  
  // Core validation
  if (dryCount === 0 && recipe.id !== 'omelette' && recipe.id !== 'stir_fry_veg') {
    issues.push("Missing dry base (flour/rice/pasta)");
  }
  if (wetCount === 0 && dryCount > 0) {
    issues.push("Missing wet ingredients to bind");
  }
  if (leaveningCount > 2) {
    issues.push("Too much leavening ‚Äì may taste bitter");
  }
  if (wetCount > dryCount * 2 && dryCount > 0) {
    issues.push("Too much liquid ‚Äì will be runny");
  }
  
  return {
    balanced: issues.length === 0,
    issues
  };
}

function scoreRecipe(recipe, pKeys){
  const req = recipe.ingredients.map(normalizeToKey);
  let match = 0, essentialMatch = 0;
  for(const r of req){ if(pKeys.includes(r)) match++; }
  for(const e of (recipe.essentials||[]).map(normalizeToKey)){ if(pKeys.includes(e)) essentialMatch++; }

  let score = match;
  score += essentialMatch * 2.0;
  score += (match / (req.length || 1)) * 1.0;
  if(match / req.length < 0.3) score *= 0.5;
  return Math.round(score*100)/100;
}

function findMatches(){
  const keys = Array.from(new Set(pantry.map(normalizeToKey)));
  if(keys.length===0) return [];
  const scored = RECIPES.map(r=>({r,score:scoreRecipe(r,keys)}))
    .filter(x=>x.score>0)
    .sort((a,b)=>b.score-a.score);
  return scored;
}

// --- RENDERING WITH FEEDBACK ---
function renderResults(){
  const matches = findMatches();
  if(pantry.length === 0){ clearResults(); return; }
  if(matches.length===0){
    mainTitle.innerText = 'No strong matches ‚Äî try a staple (egg, rice, flour)';
    mainMeta.innerText = `You have ${pantry.length} ingredient(s). Start with a base!`;
    alternatives.innerHTML = '<div class="small">Add a core ingredient to unlock recipes.</div>';
    tips.innerHTML = '<div class="small">üí° Tip: Try "flour, milk, baking powder" for $1 biscuits!</div>';
    mainSteps.innerHTML = '';
    return;
  }

  const best = matches[0];
  const keys = Array.from(new Set(pantry.map(normalizeToKey)));
  const balance = analyzeBalance(best.r, keys);
  
  openRecipe(best.r, best.score, matches.slice(1,6), balance);
  tips.innerHTML = generateTips(best.r, balance);
  renderSaved();
}

function openRecipe(r, score, altMatches, balance){
  const keys = Array.from(new Set(pantry.map(normalizeToKey)));
  const matched = r.ingredients.map(normalizeToKey).filter(k=>keys.includes(k)).length;
  
  // EMOJI FEEDBACK
  const emoji = balance.balanced ? 'üëç' : '‚ö†Ô∏è';
  const feedbackClass = balance.balanced ? 'feedback-good' : 'feedback-bad';
  
  mainTitle.innerHTML = `${emoji} ${r.title} <span class="score">${Math.round(score*100)}%</span> <span class="feedback-badge ${feedbackClass}">${balance.balanced ? 'Balanced!' : 'Needs Fix'}</span>`;
  mainMeta.innerText = `Matched ${matched}/${r.ingredients.length} ingredients. Tags: ${r.tags.join(', ')}`;
  
  // SHOW ISSUES IF UNBALANCED
  mainSteps.innerHTML = '';
  if (!balance.balanced && balance.issues.length) {
    const issueEl = document.createElement('div');
    issueEl.style.color = 'var(--error)';
    issueEl.style.fontWeight = '600';
    issueEl.innerHTML = `‚ö†Ô∏è ${balance.issues.join('; ')}.<br>Try adding missing base ingredients.`;
    mainSteps.appendChild(issueEl);
  }

  // METHOD
  const methodEl = document.createElement('div');
  methodEl.innerHTML = `<div style="font-weight:700;margin-top:10px">Quick Steps (${r.minutes} min)</div><ol style="margin-top:6px;padding-left:20px">${r.method.map(m=>`<li>${escapeHtml(m)}</li>`).join('')}</ol>`;
  mainSteps.appendChild(methodEl);

  // SAVE BUTTON
  const saveDiv = document.createElement('div');
  saveDiv.style.marginTop = '15px';
  saveDiv.innerHTML = `<button class="btn" id="saveIdea">‚≠ê Save Idea</button>`;
  saveDiv.querySelector('#saveIdea').addEventListener('click', ()=>{ 
    saved.unshift({id:r.id,title:r.title,timestamp:Date.now()}); 
    saveSaved(); 
    renderSaved(); 
  });
  mainSteps.appendChild(saveDiv);

  // ALTERNATIVES
  if (altMatches.length > 0) {
    alternatives.innerHTML = '';
    altMatches.forEach(m=>{
      const el = document.createElement('div'); el.className='alt';
      el.innerHTML = `<div><strong>${m.r.title}</strong><div class="meta">Match ${Math.round(m.score*100)}% ‚Äî ${m.r.tags.join(', ')}</div></div><div><button class="btn ghost" data-id="${m.r.id}">View</button></div>`;
      el.querySelector('button').addEventListener('click', ()=>{
        const full = RECIPES.find(rec => rec.id === m.r.id);
        const bal = analyzeBalance(full, keys);
        openRecipe(full, m.score, matches.filter(x => x.r.id !== m.r.id && x.r.id !== r.id), bal);
        alternatives.scrollIntoView({ behavior: 'smooth' });
      });
      alternatives.appendChild(el);
    });
  } else {
    alternatives.innerHTML = '<div class="small">No other strong matches.</div>';
  }
}

function generateTips(recipe, balance){
  const lines = [];
  if(recipe.tags.includes('biscuit44')) 
    lines.push('‚ù§Ô∏è Made for Biscuit 44‚Äôs $1 mission! Total cost under $1 if you buy in bulk.');
  if(balance && !balance.balanced) 
    lines.push('Fix balance: Add a dry base (flour/rice) or reduce liquids.');
  if(recipe.id==='dollar_biscuits') 
    lines.push('Pro tip: Use cold butter and don‚Äôt overmix for flaky layers!');
  return lines.length ? lines.join('<br>') : 'No special tips needed.';
}

// --- SAVED, RANDOM, EXPORT ---
function renderSaved(){
  savedList.innerHTML = '';
  if(saved.length===0) savedList.innerHTML = '<div class="small">No saved ideas.</div>';
  saved.slice(0,10).forEach((s,idx)=>{
    const r = RECIPES.find(rec => rec.id === s.id) || {title: s.title};
    const el=document.createElement('div'); el.className='alt';
    el.innerHTML = `<div><strong>${s.title}</strong><div class="meta">Saved ${new Date(s.timestamp).toLocaleDateString()}</div></div><div><button class="btn ghost" data-action="view">View</button><button class="btn ghost" data-action="remove" style="margin-left:4px">√ó</button></div>`;
    el.querySelector('[data-action="view"]').addEventListener('click', ()=>{
      if (r.id) {
        const keys = Array.from(new Set(pantry.map(normalizeToKey)));
        const bal = analyzeBalance(r, keys);
        openRecipe(r, 100, [], bal);
        mainResult.scrollIntoView({ behavior: 'smooth' });
      }
    });
    el.querySelector('[data-action="remove"]').addEventListener('click', ()=>{ 
      saved.splice(idx,1); 
      saveSaved(); 
      renderSaved(); 
    });
    savedList.appendChild(el);
  });
}

randomBtn.addEventListener('click', ()=>{
  const r = RECIPES[Math.floor(Math.random()*RECIPES.length)];
  pantry = (r.essentials || r.ingredients.slice(0,3)).map(normalize);
  savePantry();
  renderChips();
  const keys = Array.from(new Set(pantry.map(normalizeToKey)));
  const balance = analyzeBalance(r, keys);
  openRecipe(r, 100, [], balance);
});

exportBtn.addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify({pantry,saved},null,2)],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='biscuit44-ideas.json'; a.click(); URL.revokeObjectURL(url);
});
importBtn.addEventListener('click', ()=>{
  const inp = document.createElement('input'); inp.type='file'; inp.accept='application/json';
  inp.onchange = ()=>{
    const f=inp.files[0]; if(!f) return;
    const r=new FileReader();
    r.onload=()=>{
      try{
        const data=JSON.parse(r.result);
        if(data.pantry && Array.isArray(data.pantry)) pantry = data.pantry;
        if(data.saved && Array.isArray(data.saved)) saved=data.saved;
        savePantry(); saveSaved(); renderChips(); renderSaved(); renderResults();
      }catch(e){ alert('Invalid file.'); }
    };
    r.readAsText(f);
  };
  inp.click();
});

function clearResults(){
  mainTitle.innerText='Add ingredients to see suggestions';
  mainMeta.innerText='We\'ll analyze ingredient matches and common pairings.';
  mainSteps.innerHTML='';
  alternatives.innerHTML='<div class="small">Add ingredients and press Guess.</div>';
  tips.innerHTML='<div class="small">üí° Start with a staple: egg, rice, flour, or pasta.</div>';
}

// INIT
renderChips();
renderSaved();
clearResults();
</script>
</body>
</html>